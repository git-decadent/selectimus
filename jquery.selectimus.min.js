/*!
 *
 * Selectimus 0.1.0
 * Copyright 2012, Egor Skorobogatov
 * egor.skorobogatov@gmail.com
 *
 * Released under the MIT, BSD, and GPL Licenses
 * https://github.com/git-decadent/selectimus
 *
 * Change of standart selects in browser.
 * 
 * Includes ScrollBarJS.js
 *
*/

(function(e){function t(d,g,f,c){this.selected={};this.parent=e(g);this.div=e("<div>");this.box=e("<div>");var n=this,b=e("<table>"),h=e("<tbody>"),q,i;b.addClass("selectimus-table");q="Opera"==window.navigator.appName?parseInt(d.height)-2+"px":d.height;e.each(f,function(a,b){b.value==g.val()&&(n.selected.count=a,n.selected.id=g.val());i=e("<tr>");i.css("height",q);i.html("<td>"+b.innerHTML+"</td>");h.append(i);var c=b.value;i.click(function(){!0==n.opened&&(n.selected.count=a,n.selected.id=c)})}); b.append(h);this.content=b;this.button=e("<div>");this.opt={};c=void 0!=c&&void 0!=c.rows?c.rows:u;c=f.length<c?f.length:c;this.opened=!1;for(var j in d)this.div.css(j,d[j]);this.button.addClass("select-button-close");this.box.addClass("select-box");this.opt.down={height_div:d.height,height_box:"Opera"==window.navigator.appName?parseInt(d.height)-2*parseInt(d.borderWidth)+"px":d.height,overflow:"hidden",border:"0 none",zIndex:0};this.opt.up={rows:c,heightContent:f.length*parseInt(d.height)+"px",height:c* parseInt(d.height)+"px",overflow:"visible",position:"absolute",border:d.border,borderTop:"0 none",zIndex:1E8};this.box.css({height:this.opt.down.height_box,background:d.background,"border-radius":d["border-radius"]});this.div.addClass("selectimus");this.box.append(this.content);this.div.append(this.button);this.div.append(this.box);var a=this;this.div.toggle(function(){a.opened=!0;a.div.css({borderBottom:a.opt.up.borderTop,borderLeft:a.opt.up.borderTop,borderRight:a.opt.up.borderTop,overflow:a.opt.up.overflow, height:a.opt.up.height});a.box.css({position:a.opt.up.position,border:a.opt.up.border,borderTop:a.opt.up.borderTop,height:a.opt.up.height,zIndex:a.opt.up.zIndex});a.box.find("TD").eq(a.selected.id).addClass("td_hover");a.box.find("TD").hover(function(){a.box.find("TD").removeClass("td_hover");e(this).addClass("td_hover")});if(void 0==a.scrollbar){var b=a.opt,b=b.up.height==b.up.heightContent?!1:e.scrollbar({scrollpane:a.box,scrollcontent:a.content,options:{orientation:"vertical",css:{position:"absolute"}}}); a.scrollbar=b}!1!=a.scrollbar?(a.scrollbar.show(),a.scrollbar.move(-1*a.selected.count*parseInt(a.opt.down.height_box),!1)):r.call(a,-1*a.selected.count*parseInt(a.opt.down.height_box));p.one("click",function(){a.div.click()})},function(){a.opened=!1;a.div.css({border:a.opt.up.border,height:a.opt.down.height_div});a.box.css({border:a.opt.down.border,borderTop:a.opt.up.borderTop,height:a.opt.down.height_box,zIndex:a.opt.down.zIndex});!1!=a.scrollbar?(a.scrollbar.move(-1*a.selected.count*parseInt(a.opt.down.height_box), !0),a.scrollbar.hide()):r.call(a,-1*a.selected.count*parseInt(a.opt.down.height_box),!0);a.box.find("TD").unbind();a.box.find("TD").eq(a.selected.count).removeClass("td_hover");a.parent.val(a.selected.id)})}function r(d,e){var f;f=!0==e||Math.abs(d)<this.content.height()-parseInt(this.opt.up.height)?d:0;this.content.css({"margin-top":f+"px"})}var p=e(window),u=10,s={},v=0;e.fn.selectimus=function(d,g){var f={background:"white",display:"block",border:"1px solid #b6b6b6","border-radius":"5px",margin:"3px 0", position:"relative",overflow:"visible"},c;if(void 0!=d)for(c in d)f[c]=d[c];e.each(this,function(c,b){var h=e(b);if(void 0==s[h.attr("id")]){var h=e(b),d=h.children(),i=h[0],j=function(a,b){if(a.style[b])return a.style[b];if(a.currentStyle)return a.currentStyle[b];if(document.defaultView&&document.defaultView.getComputedStyle){var b=b.replace(/(A-Z)/g,"-$1"),b=b.toLowerCase(),c=document.defaultView.getComputedStyle(a,"");return c&&c.getPropertyValue(b)}return null},a={},m;m=i.style;for(var k in m)m= j(i,k),""!=m&&("none"!=m&&"function"!=typeof m)&&(a[k]=m);for(k in f)a[k]=f[k];if(void 0!=g){k={width:5,height:5};for(var l in g)void 0!=k[l]&&(a[l]=parseInt(a[l])+g[l]*k[l]+"px")}l=new t(a,h,d,g);s[h.attr("id")]=l;v++;h.css("display","none");l.div.insertBefore(h)}});return this};e.scrollbar=function(d){function g(d,b,h){d=d.height();scrollcontent_h=b.height();scrollbar_wrap_h=d-0.02*d;diff1=scrollcontent_h-d;prop=diff1/scrollcontent_h;scroll_area=scrollbar_wrap_h-2*c.btnsWidth;stopScroll=Math.floor(scroll_area* prop);size_slider=scrollbar_wrap_h-2*c.btnsWidth-stopScroll-2*c.bordersWidth;multiple=diff1/(scrollbar_wrap_h-2*c.btnsWidth-size_slider);multiple=scrollcontent_h/scroll_area;percentContent=diff1/100;percentSlider=stopScroll/100;void 0!=h&&(size_slider=height2,h.height(height2));return{scrollpane_h:d,scrollcontent_h:scrollcontent_h,scrollcontent_stop:d-scrollcontent_h,scrollbar_wrap_h:scrollbar_wrap_h,size_slider:size_slider,multiple:multiple,stopScroll:stopScroll,percentContent:percentContent,percentSlider:percentSlider}} function f(d){var b=this,h;this.scrollpane=d.scrollpane;this.scrollcontent=d.scrollcontent;this.params=g(this.scrollpane,this.scrollcontent);this.scroll_top=e("<div>").addClass("w-srcoll-top w-srcoll-btn").css({width:c.btnsWidth+"px",height:c.btnsWidth+"px",backgroundPosition:+(c.btnsWidth-14)/2+"px "+(c.btnsWidth-14)/2+"px "});this.scroll_bottom=e("<div>").addClass("w-srcoll-bottom w-srcoll-btn").css({width:c.btnsWidth+"px",height:c.btnsWidth+"px",backgroundPosition:+(c.btnsWidth-14)/2+"px 112%"}); this.scrollbar_wrap=e("<div>").addClass("w-srcollbar-wrap").css({height:this.params.scrollbar_wrap_h,width:c.btnsWidth});this.scrollbar=e("<div>").addClass("w-srcollbar").css({height:this.params.scrollbar_wrap_h-2*c.btnsWidth,marginTop:c.btnsWidth+"px",width:c.btnsWidth+"px"});this.slider=e("<div>").addClass("w-slider").css({top:0,width:c.btnsWidth-2+"px",height:this.params.size_slider+"px"}).append("<span style='margin:"+this.params.size_slider/2+"px auto;' class='ui-icon ui-icon-grip-dotted-horizontal'></span>"); this.scrollbar_wrap.append(this.scroll_top);this.scrollbar_wrap.append(this.scrollbar);this.scrollbar_wrap.append(this.scroll_bottom);this.scrollbar.append(this.slider);this.scrollbar_wrap.appendTo(this.scrollpane);var f=function(){p.unbind("mousemove",i)},i=function(c){if(1>j+c.clientY-a)return b.slider.css({top:0}),b.scrollcontent.css({"margin-top":0}),!1;if(j+c.clientY-a>b.params.stopScroll-1)return b.slider.css({top:b.params.stopScroll}),b.scrollcontent.css({"margin-top":b.params.scrollcontent_stop+ "px"}),!1;b.slider.css({top:j+c.clientY-a+"px"});b.scrollcontent.css({"margin-top":b.params.multiple*-1*(j+c.clientY-a)+"px"})},j,a;b.slider.mousedown(function(c){c.preventDefault();p.bind("mousemove",i);p.one("mouseup",f);j=parseInt(b.slider.css("top"));a=c.clientY});this.scrollbar_wrap.click(function(a){a.stopPropagation()});this.scroll_top.add(this.scroll_bottom).bind({mousedown:function(a){a.stopPropagation();var c;a.target==b.scroll_top[0]?(c=-1,stop=0):(c=1,stop=b.params.stopScroll);h=setInterval(function(){var a= parseInt(b.slider.css("top"));a==stop?(clearInterval(h),b.slider.css("top",stop+"px")):(b.slider.css("top",a+c+"px"),b.scrollcontent.css("margin-top",-1*b.params.multiple*(a+c)+"px"))},4)},mouseup:function(a){a.stopPropagation();clearInterval(h)}});this.scrollbar.bind("click",function(a){if(a.target!=b.scrollbar[0])return!1;var a=a.pageY,c=b.slider.offset().top,d=parseInt(b.scrollcontent.css("margin-top")),e,f=0,g;a<c?(e=a-c,g=-1*Math.round(2*(b.params.scrollcontent_h/b.params.scrollpane_h))):(e= a-c-b.params.size_slider,g=1*Math.round(2*(b.params.scrollcontent_h/b.params.scrollpane_h)));h=setInterval(function(){if(f+g>=e&&0<g||f+g<=e&&0>g)return clearInterval(h),b.slider.offset({top:c+e}),b.scrollcontent.css("margin-top",d-b.params.multiple*e+"px"),!1;b.slider.offset({top:b.slider.offset().top+g});b.scrollcontent.css("margin-top",parseInt(b.scrollcontent.css("margin-top"))-g*b.params.multiple+"px");f+=g},1)})}var c={btnsWidth:16,btnsHeight:16,bordersWidth:1};f.prototype.move=function(c,b){var d, e=this.params;d=c<e.scrollpane_h-e.scrollcontent_h?e.scrollpane_h-e.scrollcontent_h:c;e=Math.abs(d)/e.percentContent*e.percentSlider;this.slider.css("top",e+"px");void 0==b?this.scrollcontent.animate({"margin-top":d+"px"},800):this.scrollcontent.css({"margin-top":!0==b?c:d+"px"})};f.prototype.show=function(){this.scrollbar_wrap.css("display","block")};f.prototype.hide=function(){this.scrollbar_wrap.css("display","none")};f.prototype.renew=function(){g(this.scrollpane,this.scrollcontent,this.slider)}; return new f(d)}})(jQuery);

/*!
 *
 * Selectimus 0.1.0
 * Copyright 2012, Egor Skorobogatov
 * egor.skorobogatov@gmail.com
 *
 * Released under the MIT, BSD, and GPL Licenses
 * https://github.com/git-decadent/selectimus
 *
 * Change of standart selects in browser.
 * 
 * Includes ScrollBarJS.js
 *
*/
(function(e){function r(b,k,f,c){this.selected={};this.parent=e(k);this.div=e("<div>");this.box=e("<div>");var l=this,d=e("<ul>"),p,j;d.addClass("selectimus_ul");p="Opera"==window.navigator.appName?parseInt(b.height)-2*b["border-width"]+"px":b.height;e.each(f,function(a,c){c.value==k.val()&&(l.selected.count=a,l.selected.id=k.val());j=e("<li>").css("height",p).html(c.innerHTML);d.append(j);var b=c.value;j.click(function(){!0===l.opened&&(l.selected.count=a,l.selected.id=b)})});this.content=d;this.button= e("<div>");this.opt={};c=void 0!=c&&void 0!=c.rows?c.rows:s;c=f.length<c?f.length:c;this.opened=!1;for(var h in b)this.div.css(h,b[h]);this.opt.down={height_div:b.height,height_box:b.height,overflow:"hidden",border:"0 none",zIndex:1};this.opt.up={rows:c,heightContent:f.length*parseInt(b.height)+"px",height_div:c*parseInt(b.height)+"px",height_box:0<=window.navigator.appName.search("Microsoft")?c*parseInt(b.height)-2*parseInt(b["border-width"])+"px":c*parseInt(b.height)+"px",overflow:"visible",position:"absolute", border:b.border,borderTop:"0 none",zIndex:1E8};this.button.addClass("select-button-close").css({top:(parseInt(b.height)-t)/2+"px"});this.box.addClass("select-box").css({height:this.opt.down.height_box,background:b.background,"border-radius":b["border-radius"]});this.div.addClass("selectimus");this.box.append(this.content);this.div.append(this.button);this.div.append(this.box);var i=function(d){for(var c in m)!0===m[c].opened&&m[c].div.click();d.stopPropagation();a.opened=!0;a.button.hide();a.div.css({borderBottom:a.opt.up.borderTop, borderLeft:a.opt.up.borderTop,borderRight:a.opt.up.borderTop,overflow:a.opt.up.overflow,height:a.opt.up.height_div,zIndex:a.opt.up.zIndex});a.box.css({position:a.opt.up.position,border:a.opt.up.border,borderTop:a.opt.up.borderTop,height:a.opt.up.height_box});a.box.find("LI").eq(a.selected.id).addClass("sel_hover");a.box.find("LI").bind("mouseenter",function(){a.box.find("LI").removeClass("sel_hover");e(this).addClass("sel_hover")});void 0==a.scrollbar&&(d=a,c=a.opt,c=c.up.height_box==c.up.heightContent? !1:e.scrollbar({scrollpane:a.box,scrollcontent:a.content,options:{orientation:"vertical",css:{position:"absolute"}}}),d.scrollbar=c);!1!=a.scrollbar?(a.scrollbar.show(),a.scrollbar.move(-1*a.selected.count*parseInt(a.opt.down.height_box),!1)):q.call(a,-1*a.selected.count*parseInt(a.opt.down.height_box));n.one("click",g)},g=function(){a.opened=!1;a.button.show();a.div.css({border:a.opt.up.border,height:a.opt.down.height_div,zIndex:a.opt.down.zIndex});a.box.css({border:a.opt.down.border,borderTop:a.opt.up.borderTop, height:a.opt.down.height_box});!1!=a.scrollbar?(a.scrollbar.move(-1*a.selected.count*parseInt(a.opt.down.height_box),!0),a.scrollbar.hide()):q.call(a,-1*a.selected.count*parseInt(a.opt.down.height_box),!0);a.box.find("LI").unbind("mouseenter");a.box.find("LI").removeClass("sel_hover");a.parent.val(a.selected.id);a.div.one("click",i)},a=this;this.div.one("click",i)}function q(b,e){var f;f=!0===e||Math.abs(b)<this.content.height()-parseInt(this.opt.up.height)?b:0;this.content.css({"margin-top":f+"px"})} var n=e(document),s=10,m={},u=0,t=16;e.fn.selectimus=function(b,k){var f={background:"white",display:"inline-block","border-width":1,"border-style":"solid","border-color":"#b6b6b6","border-radius":"5px",margin:"3px 0",padding:0,position:"relative",overflow:"visible"},c;if(void 0!=b)for(c in b)f[c]=b[c];f.border=f["border-width"]+"px "+f["border-style"]+" "+f["border-color"];e.each(this,function(c,d){var b=e(d);if(void 0==m[b.attr("id")]){var b=e(d),j=b.children(),h={};h.height=22<=b[0].clientHeight? b[0].clientHeight:22;h.width=b[0].clientWidth;h["line-height"]="Opera"==window.navigator.appName?h.height-2*f["border-width"]+"px":h.height+"px";for(var i in f)h[i]=f[i];if(void 0!=k){i={width:5,height:5};for(var g in k)void 0!=i[g]&&(h[g]=parseInt(h[g])+k[g]*i[g]+"px")}g=new r(h,b,j,k);m[b.attr("id")]=g;u++;b.css("display","none");g.div.insertBefore(b)}});return this};e.scrollbar=function(b){function k(b,d,e){b=b.height();scrollcontent_h=d.height();scrollbar_wrap_h=b-0.02*b;diff1=scrollcontent_h- b;prop=diff1/scrollcontent_h;scroll_area=scrollbar_wrap_h-2*c.btnsWidth;stopScroll=Math.floor(scroll_area*prop);size_slider=scrollbar_wrap_h-2*c.btnsWidth-stopScroll-2*c.bordersWidth;multiple=diff1/(scrollbar_wrap_h-2*c.btnsWidth-size_slider);multiple=scrollcontent_h/scroll_area;percentContent=diff1/100;percentSlider=stopScroll/100;void 0!=e&&(size_slider=height2,e.height(height2));return{scrollpane_h:b,scrollcontent_h:scrollcontent_h,scrollcontent_stop:b-scrollcontent_h,scrollbar_wrap_h:scrollbar_wrap_h, size_slider:size_slider,multiple:multiple,stopScroll:stopScroll,percentContent:percentContent,percentSlider:percentSlider}}function f(b){var d=this,f;this.scrollpane=b.scrollpane;this.scrollcontent=b.scrollcontent;this.params=k(this.scrollpane,this.scrollcontent);this.scroll_top=e("<div>").addClass("w-srcoll-top w-srcoll-btn").css({width:c.btnsWidth+"px",height:c.btnsWidth+"px",backgroundPosition:+(c.btnsWidth-14)/2+"px "+(c.btnsWidth-14)/2+"px "});this.scroll_bottom=e("<div>").addClass("w-srcoll-bottom w-srcoll-btn").css({width:c.btnsWidth+ "px",height:c.btnsWidth+"px",backgroundPosition:+(c.btnsWidth-14)/2+"px 112%"});this.scrollbar_wrap=e("<div>").addClass("w-srcollbar-wrap").css({height:this.params.scrollbar_wrap_h,width:c.btnsWidth});this.scrollbar=e("<div>").addClass("w-srcollbar").css({position:"relative",height:this.params.scrollbar_wrap_h-2*c.btnsWidth,top:c.btnsWidth+"px",width:c.btnsWidth+"px"});this.slider=e("<div>").addClass("w-slider").css({top:0,width:c.btnsWidth-2+"px",height:this.params.size_slider+"px"}).append("<span style='margin:"+ this.params.size_slider/2+"px auto;'></span>");this.scrollbar_wrap.append(this.scroll_top);this.scrollbar_wrap.append(this.scrollbar);this.scrollbar_wrap.append(this.scroll_bottom);this.scrollbar.append(this.slider);this.scrollbar_wrap.appendTo(this.scrollpane);var j=function(){n.unbind("mousemove",h)},h=function(a){a.preventDefault();if(1>i+a.clientY-g)return d.slider.css({top:0}),d.scrollcontent.css({"margin-top":0}),!1;if(i+a.clientY-g>d.params.stopScroll-1)return d.slider.css({top:d.params.stopScroll}), d.scrollcontent.css({"margin-top":d.params.scrollcontent_stop+"px"}),!1;d.slider.css({top:i+a.clientY-g+"px"});d.scrollcontent.css({"margin-top":d.params.multiple*-1*(i+a.clientY-g)+"px"})},i,g;d.slider.mousedown(function(a){a.preventDefault();n.bind("mousemove",h);n.one("mouseup",j);i=parseInt(d.slider.css("top"));g=a.clientY});this.scrollbar_wrap.click(function(a){a.stopPropagation()});this.scroll_top.add(this.scroll_bottom).bind({mousedown:function(a){var b;a.target==d.scroll_top[0]?(b=-1,stop= 0):(b=1,stop=d.params.stopScroll);f=setInterval(function(){var a=parseInt(d.slider.css("top"));a==stop?(clearInterval(f),d.slider.css("top",stop+"px")):(d.slider.css("top",a+b+"px"),d.scrollcontent.css("margin-top",-1*d.params.multiple*(a+b)+"px"))},4)},mouseup:function(){clearInterval(f)}});this.scrollbar.bind("click",function(a){if(a.target!=d.scrollbar[0])return!1;var a=a.pageY,b=d.slider.offset().top,c=parseInt(d.scrollcontent.css("margin-top")),e,j=0,g;a<b?(e=a-b,g=-1*Math.round(2*(d.params.scrollcontent_h/ d.params.scrollpane_h))):(e=a-b-d.params.size_slider,g=1*Math.round(2*(d.params.scrollcontent_h/d.params.scrollpane_h)));f=setInterval(function(){if(j+g>=e&&0<g||j+g<=e&&0>g)return clearInterval(f),d.slider.offset({top:b+e}),d.scrollcontent.css("margin-top",c-d.params.multiple*e+"px"),!1;d.slider.offset({top:d.slider.offset().top+g});d.scrollcontent.css("margin-top",parseInt(d.scrollcontent.css("margin-top"))-g*d.params.multiple+"px");j+=g},1)})}var c={btnsWidth:16,btnsHeight:16,bordersWidth:1};f.prototype.move= function(b,d){var c,e=this.params;c=b<e.scrollpane_h-e.scrollcontent_h?e.scrollpane_h-e.scrollcontent_h:b;e=Math.abs(c)/e.percentContent*e.percentSlider;this.slider.css("top",e+"px");void 0==d?this.scrollcontent.animate({"margin-top":c+"px"},800):this.scrollcontent.css({"margin-top":!0===d?b:c+"px"})};f.prototype.show=function(){this.scrollbar_wrap.css("display","block")};f.prototype.hide=function(){this.scrollbar_wrap.css("display","none")};f.prototype.renew=function(){k(this.scrollpane,this.scrollcontent, this.slider)};return new f(b)}})(jQuery);

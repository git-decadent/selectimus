/*!
*
* Selectimus 1.0.0
* Copyright 2012, Egor Skorobogatov
* egor.skorobogatov@gmail.com
*
* Released under the MIT license.
* https://github.com/git-decadent/selectimus
*
* Change of standart selects in browser.
*
* Includes ScrollBarJS.js
*
*/
(function(f){function r(a,c){var d;d=!0===c||Math.abs(a)<this.content.height()-this.opt.up.heightParse?a:0;this.content.css({"margin-top":d+"px"})}function v(){}function s(){}function w(a,c){var d=function(){},b;d.prototype=c.prototype;for(b in a.prototype)d.prototype[b]=a.prototype[b];a.prototype=new d;a.prototype.constructor=a;a.superclass=c.prototype}function t(a,c,d,b){var u;b=void 0!==b&&void 0!==b.rows?b.rows:x;var e=d.length<b?d.length:b;this.selected={};this.parent=f(c);this.div=f("<div>"); this.box=f("<div>");this.current_line=f("<div>");var l=this,h=f("<ul>"),k;l.length=0;h.addClass("selectimus_ul");f.each(d,function(e,b){l.length+=1;b.value==c.val()&&(l.selected.count=e,l.selected.id=c.val());k=f("<li>").attr({value:e}).css({height:a.main.height,"line-height":a.main["line-height"]}).html(b.innerHTML);h.append(k)});h.bind("click",function(a){a=a.target;!0===l.opened&&(l.selected.count=parseInt(a.getAttribute("value"),10),l.selected.id=a.innerHTML)});this.content=h;this.button=f("<div>"); this.opt={};this.opened=!1;for(u in a.main)this.div.css(u,a.main[u]);this.opt.down={height:a.main.height,heightParse:parseInt(a.main.height,10),overflow:"hidden",border:"0 none",zIndex:1,background:a.main.background,visibility:"hidden",color:a.main.color};this.opt.up={rows:e,heightContent:d.length*parseInt(a.main.height,10)+"px",height:e*parseInt(a.main.height,10)+"px",heightParse:e*parseInt(a.main.height,10),overflow:"visible",position:"absolute",borderTop:"0 none",zIndex:1E8,background:a.main.background_up, color:a.main.color_up,visibility:"visible"};this.opt.border=a.border;this.button.addClass("select-button-close").css({top:(this.opt.down.heightParse-y)/2+"px"});this.content.css({background:a.main.background,height:this.opt.up.heightContent});this.box.addClass("select-box").css({height:this.opt.down.height,background:a.main.background,visibility:this.opt.down.visibility});this.current_line.addClass("current_line").css({"border-radius":a.border["border-radius"],"border-width":a.border["border-width"], "border-color":a.border["border-color"],"border-style":a.border["border-style"],height:this.opt.down.height}).html("<span>"+this.selected.id+"</span>");this.current_step=this.length-this.selected.count<=b?Math.ceil(this.length/b):Math.ceil(0==this.selected.count?1:this.selected.count/b);this.current_stop=-1*this.opt.up.heightParse;this.div.addClass("selectimus");this.box.append(this.content);this.div.append(this.current_line);this.div.append(this.button);this.div.append(this.box);var g=this;this.div.one("click", function(a){g.select_open(a)});r.call(this,-1*this.selected.count*this.opt.down.heightParse,!0)}var n=f(document),x=10,p={},y=16,q;v.prototype.keyCodeOn=function(a){var c=a.keyCode,d,b,f,e;if(40==c||38==c||13==c)if(a.preventDefault(),f=this.parent[0].length,d=this.content.find("LI"),b=this.selected.over,this.selected.id=d.eq(b).html(),this.selected.count=d.eq(b).val(),13!=c){a=40==c?1:-1;if(b==f-1&&1==a||0==b&&-1==a)return!1;f=this.opt.down.heightParse;e=this.opt.up.heightParse;d.css({background:this.opt.down.background, color:this.opt.down.color});d.eq(b+a).css({background:this.opt.up.background,color:this.opt.up.color});this.selected.over+=a;40==c&&this.selected.count*f>-1*parseInt(this.content.css("margin-top"),10)-this.current_stop-2*f?(this.current_step+=a,this.scrollbar.move(-1*e*(this.current_step-1),!1)):38==c&&this.selected.count*f==-1*parseInt(this.content.css("margin-top"),10)&&(this.current_step+=a,this.scrollbar.move(-1*e*(this.current_step-1),!1))}else n.click()};s.prototype.select_hide=function(){var a= this;q=void 0;this.opened=!1;this.button.show();this.div.css({height:this.opt.down.height,zIndex:this.opt.down.zIndex});this.box.removeClass("select-box-open").css({height:this.opt.down.height,visibility:this.opt.down.visibility});this.current_line.css({background:this.opt.down.background,"border-bottom":this.opt.border["border-width"]+" "+this.opt.border["border-style"]+" "+this.opt.border["border-color"],"border-radius":this.opt.border["border-radius"],"box-shadow":""});!1!==this.scrollbar?(this.scrollbar.move(-1* this.selected.count*this.opt.down.heightParse,!0),this.scrollbar.hide()):r.call(this,-1*this.selected.count*this.opt.down.heightParse,!0);this.box.find("LI").unbind("mouseenter");this.box.find("LI").css({background:this.opt.down.background,color:this.opt.down.color});this.parent.val(this.selected.id);this.current_line.html("<span>"+this.selected.id+"</span>");this.div.one("click",function(c){a.select_open(c)})};s.prototype.select_open=function(a){var c=this,d;for(d in p)!0===p[d].opened&&p[d].div.click(); q=this;a.stopPropagation();this.opened=!0;this.button.hide();this.div.css({height:this.opt.up.height,zIndex:this.opt.up.zIndex});this.box.addClass("select-box-open").css({position:this.opt.up.position,border:this.opt.border["border-width"]+" "+this.opt.border["border-style"]+" "+this.opt.border["border-color"],"border-radius":"0 0 "+this.opt.border["border-radius"]+" "+this.opt.border["border-radius"],height:this.opt.up.height,visibility:this.opt.up.visibility,"margin-top":this.opt.down.height,"border-top-right-radius":0, "border-top-left-radius":0});this.current_line.css({background:this.opt.up.background,"border-bottom":"0 none","border-bottom-right-radius":0,"border-bottom-left-radius":0,"box-shadow":"4px 3px 6px #CCCCCC"});this.box.append();this.selected.over=this.selected.count;this.box.find("LI").eq(this.selected.count).css({background:this.opt.up.background,color:this.opt.up.color});this.box.find("LI").bind("mouseenter",function(a){c.box.find("LI").css({background:c.opt.down.background,color:c.opt.down.color}); f(a.target).css({background:c.opt.up.background,color:c.opt.up.color});c.selected.over=parseInt(a.target.getAttribute("value"),10)});void 0===this.scrollbar&&(a=this.opt,this.scrollbar=a.up.height==a.up.heightContent?!1:f.scrollbar({scrollpane:this.box,scrollcontent:this.content}));!1!==this.scrollbar?(this.scrollbar.show(),this.scrollbar.move(-1*this.opt.up.heightParse*(this.current_step-1),!1)):r.call(this,-1*this.selected.count*this.opt.down.heightParse);n.one("click",function(a){c.select_hide(a)})}; w(t,s);w(t,v);n.bind("keydown",function(a){void 0!==q&&q.keyCodeOn(a)});f.fn.selectimus=function(a,c){var d={color:"#000",background:"#FFF",color_up:"#FFF",background_up:"#7ea0fa",display:"inline-block","border-width":"1px","border-style":"solid","border-color":"#b6b6b6","border-radius":"5px",margin:"3px 0",padding:0,position:"relative",overflow:"visible"},b;if(void 0!==a)for(b in a)d[b]=a[b];d.border=d["border-width"]+" "+d["border-style"]+" "+d["border-color"];f.each(this,function(a,e){var b=f(e); if(void 0===p[b.attr("id")]){var b=f(e),h=b.children(),k,g={main:{},border:{}};g.main.height=void 0!==d.height?parseInt(d.height,10):22<=b[0].clientHeight?b[0].clientHeight:22;g.main.width=b[0].clientWidth;g.main["line-height"]=g.main.height+"px";for(k in d)0<=k.search("border")?g.border[k]=d[k]:g.main[k]=d[k];if(void 0!==c){k=g.main;var j,m={width:5,height:5};for(j in c)void 0!==m[j]&&(k[j]=parseInt(k[j],10)+c[j]*m[j]+"px")}j=new t(g,b,h,c);p[b.attr("id")]=j;b.css("display","none");j.div.insertBefore(b)}}); return this};f.scrollbar=function(a){function c(a,e){var d=a.height(),c=e.height(),f=d-0.02*d,g=c-d,j=f-2*b.btnsWidth,m=Math.floor(j*(g/c));return{scrollpane_h:d,scrollcontent_h:c,scrollcontent_stop:d-c,scrollbar_wrap_h:f,size_slider:f-2*b.btnsWidth-m-2*b.bordersWidth,multiple:c/j,stopScroll:m,percentContent:g/100,percentSlider:m/100}}function d(a){var e=this,d;this.scrollpane=a.scrollpane;this.scrollcontent=a.scrollcontent;this.params=c(this.scrollpane,this.scrollcontent);this.scroll_top=f("<div>").addClass("w-srcoll-top w-srcoll-btn").css({width:b.btnsWidth+ "px",height:b.btnsWidth+"px",backgroundPosition:+(b.btnsWidth-14)/2+"px "+(b.btnsWidth-14)/2+"px "});this.scroll_bottom=f("<div>").addClass("w-srcoll-bottom w-srcoll-btn").css({width:b.btnsWidth+"px",height:b.btnsWidth+"px",backgroundPosition:(b.btnsWidth-14)/2+"px 112%"});this.scrollbar_wrap=f("<div>").addClass("w-srcollbar-wrap").css({height:this.params.scrollbar_wrap_h,width:b.btnsWidth});this.scrollbar=f("<div>").addClass("w-srcollbar").css({position:"relative",height:this.params.scrollbar_wrap_h- 2*b.btnsWidth,top:b.btnsWidth+"px",width:b.btnsWidth+"px"});this.slider=f("<div>").addClass("w-slider").css({top:0,width:b.btnsWidth-2+"px",height:this.params.size_slider+"px"}).append("<span style='margin:"+this.params.size_slider/2+"px auto;'></span>");this.scrollbar_wrap.append(this.scroll_top);this.scrollbar_wrap.append(this.scrollbar);this.scrollbar_wrap.append(this.scroll_bottom);this.scrollbar.append(this.slider);this.scrollbar_wrap.appendTo(this.scrollpane);var h=function(a){a.preventDefault(); if(1>g+a.clientY-j)return e.slider.css({top:0}),e.scrollcontent.css({"margin-top":0}),!1;if(g+a.clientY-j>e.params.stopScroll-1)return e.slider.css({top:e.params.stopScroll}),e.scrollcontent.css({"margin-top":e.params.scrollcontent_stop+"px"}),!1;e.slider.css({top:g+a.clientY-j+"px"});e.scrollcontent.css({"margin-top":-1*e.params.multiple*(g+a.clientY-j)+"px"})},k=function(){n.unbind("mousemove",h)},g,j;e.slider.mousedown(function(a){a.preventDefault();n.bind("mousemove",h);n.one("mouseup",k);g=parseInt(e.slider.css("top"), 10);j=a.clientY});this.scrollbar_wrap.click(function(a){a.stopPropagation()});this.scroll_top.add(this.scroll_bottom).bind({mousedown:function(a){var b,c;a.target==e.scroll_top[0]?(b=-1,c=0):(b=1,c=e.params.stopScroll);d=setInterval(function(){var a=parseInt(e.slider.css("top"),10);a==c?(clearInterval(d),e.slider.css("top",c+"px")):(e.slider.css("top",a+b+"px"),e.scrollcontent.css("margin-top",-1*e.params.multiple*(a+b)+"px"))},4)},mouseup:function(){clearInterval(d)}});this.scrollbar.bind("click", function(a){if(a.target!=e.scrollbar[0])return!1;a=a.pageY;var b=e.slider.offset().top,c=parseInt(e.scrollcontent.css("margin-top"),10),f,g=0,h;a<b?(f=a-b,h=-1*Math.round(2*(e.params.scrollcontent_h/e.params.scrollpane_h))):(f=a-b-e.params.size_slider,h=1*Math.round(2*(e.params.scrollcontent_h/e.params.scrollpane_h)));d=setInterval(function(){if(g+h>=f&&0<h||g+h<=f&&0>h)return clearInterval(d),e.slider.offset({top:b+f}),e.scrollcontent.css("margin-top",c-e.params.multiple*f+"px"),!1;e.slider.offset({top:e.slider.offset().top+ h});e.scrollcontent.css("margin-top",parseInt(e.scrollcontent.css("margin-top"),10)-h*e.params.multiple+"px");g+=h},1)})}var b={btnsWidth:16,btnsHeight:16,bordersWidth:1};d.prototype.move=function(a,b){var d,c=this.params;d=a<c.scrollpane_h-c.scrollcontent_h?c.scrollpane_h-c.scrollcontent_h:a;c=Math.abs(d)/c.percentContent*c.percentSlider;this.slider.css("top",c+"px");void 0==b?this.scrollcontent.animate({"margin-top":d+"px"},800):this.scrollcontent.css({"margin-top":!0===b?a:d+"px"})};d.prototype.show= function(){this.scrollbar_wrap.css("display","block")};d.prototype.hide=function(){this.scrollbar_wrap.css("display","none")};d.prototype.renew=function(){c(this.scrollpane,this.scrollcontent,this.slider)};return new d(a)}})(window.jQuery);
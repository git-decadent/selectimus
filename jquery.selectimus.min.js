/*!
*
* Selectimus 0.1.0
* Copyright 2012, Egor Skorobogatov
* egor.skorobogatov@gmail.com
*
* Released under the MIT, BSD, and GPL Licenses
* https://github.com/git-decadent/selectimus
*
* Change of standart selects in browser.
*
* Includes ScrollBarJS.js
*
*/
(function(h){function r(b,f){var e;e=!0===f||Math.abs(b)<this.content.height()-parseInt(this.opt.up.height,10)?b:0;this.content.css({"margin-top":e+"px"})}function s(){}function n(b,f,e,c){this.selected={};this.parent=h(f);this.div=h("<div>");this.box=h("<div>");var k=this,d=h("<ul>"),v;d.addClass("selectimus_ul");h.each(e,function(a,c){c.value==f.val()&&(k.selected.count=a,k.selected.id=f.val());v=h("<li>").attr({value:a}).css("height",b.height).html(c.innerHTML);d.append(v)});d.bind("click",function(a){a= a.target;!0===k.opened&&(k.selected.count=parseInt(a.getAttribute("value"),10),k.selected.id=a.innerHTML)});this.content=d;this.button=h("<div>");this.opt={};this.opened=!1;var j;c=void 0!==c&&void 0!==c.rows?c.rows:x;c=e.length<c?e.length:c;for(j in b)this.div.css(j,b[j]);this.opt.down={height:b.height,overflow:"hidden",border:"0 none",zIndex:1,background:b.background,color:b.color};this.opt.up={rows:c,heightContent:e.length*parseInt(b.height,10)+"px",height:c*parseInt(b.height,10)+"px",overflow:"visible", position:"absolute",border:b.border,borderTop:"0 none",zIndex:1E8,background:b.background_up,color:b.color_up};this.button.addClass("select-button-close").css({top:(parseInt(b.height,10)-y)/2+"px"});this.box.addClass("select-box").css({height:this.opt.down.height,background:b.background_down,"border-radius":b["border-radius"]});this.current_step=1;this.current_stop=-1*parseInt(this.opt.up.height,10);this.div.addClass("selectimus");this.box.append(this.content);this.div.append(this.button);this.div.append(this.box); var l=function(){q=void 0;a.opened=!1;a.button.show();a.div.css({border:a.opt.up.border,height:a.opt.down.height,zIndex:a.opt.down.zIndex});a.box.removeClass("select-box-open").css({border:a.opt.down.border,borderTop:a.opt.up.borderTop,height:a.opt.down.height});!1!==a.scrollbar?(a.scrollbar.move(-1*a.selected.count*parseInt(a.opt.down.height,10),!0),a.scrollbar.hide()):r.call(a,-1*a.selected.count*parseInt(a.opt.down.height,10),!0);a.box.find("LI").unbind("mouseenter");a.box.find("LI").css({background:a.opt.down.background, color:a.opt.down.color});a.parent.val(a.selected.id);a.div.one("click",g)},g=function(d){q=a;for(var c in p)!0===p[c].opened&&p[c].div.click();d.stopPropagation();a.opened=!0;a.button.hide();a.div.css({borderBottom:a.opt.up.borderTop,borderLeft:a.opt.up.borderTop,borderRight:a.opt.up.borderTop,overflow:a.opt.up.overflow,height:a.opt.up.height,zIndex:a.opt.up.zIndex});a.box.addClass("select-box-open").css({position:a.opt.up.position,border:a.opt.up.border,borderTop:a.opt.up.borderTop,height:a.opt.up.height}); a.selected.over=a.selected.count;a.box.find("LI").eq(a.selected.id).css({background:u.background2,color:u.color2});a.box.find("LI").bind("mouseenter",function(d){a.box.find("LI").css({background:a.opt.down.background,color:a.opt.down.color});h(d.target).css({background:a.opt.up.background,color:a.opt.up.color});a.selected.over=parseInt(d.target.getAttribute("value"),10)});void 0===a.scrollbar&&(d=a,c=a.opt,c=c.up.height==c.up.heightContent?!1:h.scrollbar({scrollpane:a.box,scrollcontent:a.content, options:{orientation:"vertical",css:{position:"absolute"}}}),d.scrollbar=c);!1!==a.scrollbar?(a.scrollbar.show(),a.scrollbar.move(-1*a.selected.count*parseInt(a.opt.down.height,10),!1)):r.call(a,-1*a.selected.count*parseInt(a.opt.down.height,10));m.one("click",l)},a=this;this.div.one("click",g);r.call(this,-1*this.selected.count*parseInt(this.opt.down.height,10),!0)}var m=h(document),u=function(){return{color:"#000",background:"#FFF",color_up:"#FFF",background_up:"#7ea0fa",display:"inline-block", "border-width":"1px","border-style":"solid","border-color":"#b6b6b6","border-radius":"5px",margin:"3px 0",padding:0,position:"relative",overflow:"visible"}},x=10,p={},y=16,q;s.prototype.keyCodeOn=function(b){var f=b.keyCode,e,c,k,d;if(40==f||38==f||13==f)if(b.preventDefault(),k=this.parent[0].length,e=this.content.find("LI"),c=this.selected.over,this.selected.id=e.eq(c).html(),this.selected.count=e.eq(c).val(),13!=f){b=40==f?1:-1;if(c==k-1&&1==b||0==c&&-1==b)return!1;k=parseInt(this.opt.down.height, 10);d=parseInt(this.opt.up.height,10);e.css({background:this.opt.down.background,color:this.opt.down.color});e.eq(c+b).css({background:this.opt.up.background,color:this.opt.up.color});this.selected.over+=b;40==f&&this.selected.count*k>-1*parseInt(this.content.css("margin-top"),10)-this.current_stop-2*k?(this.current_step+=b,this.scrollbar.move(-1*d*(this.current_step-1),!1)):38==f&&this.selected.count*k==-1*parseInt(this.content.css("margin-top"),10)&&(this.current_step+=b,this.scrollbar.move(-1* d*(this.current_step-1),!1))}else m.click()};var w=function(){};w.prototype=s.prototype;n.prototype=new w;n.prototype.constructor=n[void 0];n.superclass=s.prototype;m.bind("keydown",function(b){void 0!==q&&q.keyCodeOn(b)});h.fn.selectimus=function(b,f){var e=u(),c;if(void 0!==b)for(c in b)e[c]=b[c];e.border=e["border-width"]+" "+e["border-style"]+" "+e["border-color"];h.each(this,function(c,d){var b=h(d);if(void 0===p[b.attr("id")]){var b=h(d),j=b.children(),l,g={};g.height=void 0!==e.height?parseInt(e.height, 10):22<=b[0].clientHeight?b[0].clientHeight:22;g.width=b[0].clientWidth;g["line-height"]="Opera"==window.navigator.appName?g.height-2*e["border-width"]+"px":g.height+"px";for(l in e)g[l]=e[l];if(void 0!==f){var a;options={width:5,height:5};for(a in f)void 0!==options[a]&&(g[a]=parseInt(g[a],10)+f[a]*options[a]+"px")}l=new n(g,b,j,f);p[b.attr("id")]=l;b.css("display","none");l.div.insertBefore(b)}});return this};h.scrollbar=function(b){function f(b,d){var e=b.height(),j=d.height(),f=e-0.02*e,g=j-e, a=f-2*c.btnsWidth,t=Math.floor(a*(g/j));return{scrollpane_h:e,scrollcontent_h:j,scrollcontent_stop:e-j,scrollbar_wrap_h:f,size_slider:f-2*c.btnsWidth-t-2*c.bordersWidth,multiple:j/a,stopScroll:t,percentContent:g/100,percentSlider:t/100}}function e(b){var d=this,e;this.scrollpane=b.scrollpane;this.scrollcontent=b.scrollcontent;this.params=f(this.scrollpane,this.scrollcontent);this.scroll_top=h("<div>").addClass("w-srcoll-top w-srcoll-btn").css({width:c.btnsWidth+"px",height:c.btnsWidth+"px",backgroundPosition:+(c.btnsWidth- 14)/2+"px "+(c.btnsWidth-14)/2+"px "});this.scroll_bottom=h("<div>").addClass("w-srcoll-bottom w-srcoll-btn").css({width:c.btnsWidth+"px",height:c.btnsWidth+"px",backgroundPosition:(c.btnsWidth-14)/2+"px 112%"});this.scrollbar_wrap=h("<div>").addClass("w-srcollbar-wrap").css({height:this.params.scrollbar_wrap_h,width:c.btnsWidth});this.scrollbar=h("<div>").addClass("w-srcollbar").css({position:"relative",height:this.params.scrollbar_wrap_h-2*c.btnsWidth,top:c.btnsWidth+"px",width:c.btnsWidth+"px"}); this.slider=h("<div>").addClass("w-slider").css({top:0,width:c.btnsWidth-2+"px",height:this.params.size_slider+"px"}).append("<span style='margin:"+this.params.size_slider/2+"px auto;'></span>");this.scrollbar_wrap.append(this.scroll_top);this.scrollbar_wrap.append(this.scrollbar);this.scrollbar_wrap.append(this.scroll_bottom);this.scrollbar.append(this.slider);this.scrollbar_wrap.appendTo(this.scrollpane);var j=function(b){b.preventDefault();if(1>g+b.clientY-a)return d.slider.css({top:0}),d.scrollcontent.css({"margin-top":0}), !1;if(g+b.clientY-a>d.params.stopScroll-1)return d.slider.css({top:d.params.stopScroll}),d.scrollcontent.css({"margin-top":d.params.scrollcontent_stop+"px"}),!1;d.slider.css({top:g+b.clientY-a+"px"});d.scrollcontent.css({"margin-top":d.params.multiple*-1*(g+b.clientY-a)+"px"})},l=function(){m.unbind("mousemove",j)},g,a;d.slider.mousedown(function(b){b.preventDefault();m.bind("mousemove",j);m.one("mouseup",l);g=parseInt(d.slider.css("top"),10);a=b.clientY});this.scrollbar_wrap.click(function(a){a.stopPropagation()}); this.scroll_top.add(this.scroll_bottom).bind({mousedown:function(a){var b,c;a.target==d.scroll_top[0]?(b=-1,c=0):(b=1,c=d.params.stopScroll);e=setInterval(function(){var a=parseInt(d.slider.css("top"),10);a==c?(clearInterval(e),d.slider.css("top",c+"px")):(d.slider.css("top",a+b+"px"),d.scrollcontent.css("margin-top",-1*d.params.multiple*(a+b)+"px"))},4)},mouseup:function(){clearInterval(e)}});this.scrollbar.bind("click",function(a){if(a.target!=d.scrollbar[0])return!1;a=a.pageY;var b=d.slider.offset().top, c=parseInt(d.scrollcontent.css("margin-top"),10),f,j=0,g;a<b?(f=a-b,g=-1*Math.round(2*(d.params.scrollcontent_h/d.params.scrollpane_h))):(f=a-b-d.params.size_slider,g=1*Math.round(2*(d.params.scrollcontent_h/d.params.scrollpane_h)));e=setInterval(function(){if(j+g>=f&&0<g||j+g<=f&&0>g)return clearInterval(e),d.slider.offset({top:b+f}),d.scrollcontent.css("margin-top",c-d.params.multiple*f+"px"),!1;d.slider.offset({top:d.slider.offset().top+g});d.scrollcontent.css("margin-top",parseInt(d.scrollcontent.css("margin-top"), 10)-g*d.params.multiple+"px");j+=g},1)})}var c={btnsWidth:16,btnsHeight:16,bordersWidth:1};e.prototype.move=function(b,d){var c,e=this.params;c=b<e.scrollpane_h-e.scrollcontent_h?e.scrollpane_h-e.scrollcontent_h:b;e=Math.abs(c)/e.percentContent*e.percentSlider;this.slider.css("top",e+"px");void 0==d?this.scrollcontent.animate({"margin-top":c+"px"},800):this.scrollcontent.css({"margin-top":!0===d?b:c+"px"})};e.prototype.show=function(){this.scrollbar_wrap.css("display","block")};e.prototype.hide=function(){this.scrollbar_wrap.css("display", "none")};e.prototype.renew=function(){f(this.scrollpane,this.scrollcontent,this.slider)};return new e(b)}})(window.jQuery);
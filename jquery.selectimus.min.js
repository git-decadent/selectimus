/*!
*
* Selectimus 0.1.0
* Copyright 2012, Egor Skorobogatov
* egor.skorobogatov@gmail.com
*
* Released under the MIT, BSD, and GPL Licenses
* https://github.com/git-decadent/selectimus
*
* Change of standart selects in browser.
*
* Includes ScrollBarJS.js
*
*/
(function(h){function u(e,f){var d;d=!0===f||Math.abs(e)<this.content.height()-parseInt(this.opt.up.height,10)?e:0;this.content.css({"margin-top":d+"px"})}function s(){}function p(e,f,d,b){this.selected={};this.parent=h(f);this.div=h("<div>");this.box=h("<div>");var j=this,c=h("<ul>"),k;c.addClass("selectimus_ul");h.each(d,function(a,b){b.value==f.val()&&(j.selected.count=a,j.selected.id=f.val());k=h("<li>").attr({value:a}).css("height",e.height).html(b.innerHTML);c.append(k)});c.bind("click",function(a){a= a.target;!0===j.opened&&(j.selected.count=parseInt(a.getAttribute("value"),10),j.selected.id=a.innerHTML)});this.content=c;this.button=h("<div>");this.opt={};this.opened=!1;var m;b=void 0!==b&&void 0!==b.rows?b.rows:w;b=d.length<b?d.length:b;for(m in e)this.div.css(m,e[m]);this.opt.down={height:e.height,overflow:"hidden",border:"0 none",zIndex:1};this.opt.up={rows:b,heightContent:d.length*parseInt(e.height,10)+"px",height:b*parseInt(e.height,10)+"px",overflow:"visible",position:"absolute",border:e.border, borderTop:"0 none",zIndex:1E8};this.button.addClass("select-button-close").css({top:(parseInt(e.height,10)-x)/2+"px"});this.box.addClass("select-box").css({height:this.opt.down.height,background:e.background,"border-radius":e["border-radius"]});this.current_step=1;this.current_stop=-1*parseInt(this.opt.up.height,10);this.div.addClass("selectimus");this.box.append(this.content);this.div.append(this.button);this.div.append(this.box);var l=function(){r=void 0;a.opened=!1;a.button.show();a.div.css({border:a.opt.up.border, height:a.opt.down.height,zIndex:a.opt.down.zIndex});a.box.removeClass("select-box-open").css({border:a.opt.down.border,borderTop:a.opt.up.borderTop,height:a.opt.down.height});!1!==a.scrollbar?(a.scrollbar.move(-1*a.selected.count*parseInt(a.opt.down.height,10),!0),a.scrollbar.hide()):u.call(a,-1*a.selected.count*parseInt(a.opt.down.height,10),!0);a.box.find("LI").unbind("mouseenter");a.box.find("LI").removeClass("sel_hover");a.parent.val(a.selected.id);a.div.one("click",g)},g=function(c){r=a;for(var b in q)!0=== q[b].opened&&q[b].div.click();c.stopPropagation();a.opened=!0;a.button.hide();a.div.css({borderBottom:a.opt.up.borderTop,borderLeft:a.opt.up.borderTop,borderRight:a.opt.up.borderTop,overflow:a.opt.up.overflow,height:a.opt.up.height,zIndex:a.opt.up.zIndex});a.box.addClass("select-box-open").css({position:a.opt.up.position,border:a.opt.up.border,borderTop:a.opt.up.borderTop,height:a.opt.up.height});a.selected.over=a.selected.count;a.box.find("LI").eq(a.selected.id).addClass("sel_hover");a.box.find("LI").bind("mouseenter", function(c){a.box.find("LI").removeClass("sel_hover");h(c.target).attr({"class":"sel_hover"});a.selected.over=parseInt(c.target.getAttribute("value"),10)});void 0===a.scrollbar&&(c=a,b=a.opt,b=b.up.height==b.up.heightContent?!1:h.scrollbar({scrollpane:a.box,scrollcontent:a.content,options:{orientation:"vertical",css:{position:"absolute"}}}),c.scrollbar=b);!1!==a.scrollbar?(a.scrollbar.show(),a.scrollbar.move(-1*a.selected.count*parseInt(a.opt.down.height,10),!1)):u.call(a,-1*a.selected.count*parseInt(a.opt.down.height, 10));n.one("click",l)},a=this;this.div.one("click",g)}var n=h(document),w=10,q={},x=16,r;s.prototype.keyCodeOn=function(e){var f=e.keyCode,d,b,j,c;if(40==f||38==f||13==f)if(e.preventDefault(),j=this.parent[0].length,d=this.content.find("LI"),b=this.selected.over,this.selected.id=d.eq(b).html(),this.selected.count=d.eq(b).val(),13!=f){e=40==f?1:-1;if(b==j-1&&1==e||0==b&&-1==e)return!1;j=parseInt(this.opt.down.height,10);c=parseInt(this.opt.up.height,10);d.removeClass("sel_hover");d.eq(b+e).addClass("sel_hover"); this.selected.over+=e;if(40==f&&this.selected.count*j>-1*this.current_stop*this.current_step-2*j||38==f&&this.selected.count*j<-1*this.current_stop*this.current_step-c+j)this.current_step+=e,this.scrollbar.move(-1*c*(this.current_step-1),!1)}else n.click()};var v=function(){};v.prototype=s.prototype;p.prototype=new v;p.prototype.constructor=p[void 0];p.superclass=s.prototype;h.fn.selectimus=function(e,f){var d={background:"white",display:"inline-block","border-width":1,"border-style":"solid","border-color":"#b6b6b6", "border-radius":"5px",margin:"3px 0",padding:0,position:"relative",overflow:"visible"},b;if(void 0!==e)for(b in e)d[b]=e[b];d.border=d["border-width"]+"px "+d["border-style"]+" "+d["border-color"];h.each(this,function(b,c){var k=h(c);if(void 0===q[k.attr("id")]){var k=h(c),e=k.children(),l,g={};g.height=void 0!==d.height?parseInt(d.height,10):22<=k[0].clientHeight?k[0].clientHeight:22;g.width=k[0].clientWidth;g["line-height"]="Opera"==window.navigator.appName?g.height-2*d["border-width"]+"px":g.height+ "px";for(l in d)g[l]=d[l];if(void 0!==f){var a;options={width:5,height:5};for(a in f)void 0!==options[a]&&(g[a]=parseInt(g[a],10)+f[a]*options[a]+"px")}l=new p(g,k,e,f);q[k.attr("id")]=l;k.css("display","none");l.div.insertBefore(k)}});n.bind("keydown",function(b){void 0!==r&&r.keyCodeOn(b)});return this};h.scrollbar=function(e){function f(e,c){var d=e.height(),f=c.height(),h=d-0.02*d,g=f-d,a=h-2*b.btnsWidth,t=Math.floor(a*(g/f));return{scrollpane_h:d,scrollcontent_h:f,scrollcontent_stop:d-f,scrollbar_wrap_h:h, size_slider:h-2*b.btnsWidth-t-2*b.bordersWidth,multiple:f/a,stopScroll:t,percentContent:g/100,percentSlider:t/100}}function d(d){var c=this,e;this.scrollpane=d.scrollpane;this.scrollcontent=d.scrollcontent;this.params=f(this.scrollpane,this.scrollcontent);this.scroll_top=h("<div>").addClass("w-srcoll-top w-srcoll-btn").css({width:b.btnsWidth+"px",height:b.btnsWidth+"px",backgroundPosition:+(b.btnsWidth-14)/2+"px "+(b.btnsWidth-14)/2+"px "});this.scroll_bottom=h("<div>").addClass("w-srcoll-bottom w-srcoll-btn").css({width:b.btnsWidth+ "px",height:b.btnsWidth+"px",backgroundPosition:(b.btnsWidth-14)/2+"px 112%"});this.scrollbar_wrap=h("<div>").addClass("w-srcollbar-wrap").css({height:this.params.scrollbar_wrap_h,width:b.btnsWidth});this.scrollbar=h("<div>").addClass("w-srcollbar").css({position:"relative",height:this.params.scrollbar_wrap_h-2*b.btnsWidth,top:b.btnsWidth+"px",width:b.btnsWidth+"px"});this.slider=h("<div>").addClass("w-slider").css({top:0,width:b.btnsWidth-2+"px",height:this.params.size_slider+"px"}).append("<span style='margin:"+ this.params.size_slider/2+"px auto;'></span>");this.scrollbar_wrap.append(this.scroll_top);this.scrollbar_wrap.append(this.scrollbar);this.scrollbar_wrap.append(this.scroll_bottom);this.scrollbar.append(this.slider);this.scrollbar_wrap.appendTo(this.scrollpane);var m=function(b){b.preventDefault();if(1>g+b.clientY-a)return c.slider.css({top:0}),c.scrollcontent.css({"margin-top":0}),!1;if(g+b.clientY-a>c.params.stopScroll-1)return c.slider.css({top:c.params.stopScroll}),c.scrollcontent.css({"margin-top":c.params.scrollcontent_stop+ "px"}),!1;c.slider.css({top:g+b.clientY-a+"px"});c.scrollcontent.css({"margin-top":c.params.multiple*-1*(g+b.clientY-a)+"px"})},l=function(){n.unbind("mousemove",m)},g,a;c.slider.mousedown(function(b){b.preventDefault();n.bind("mousemove",m);n.one("mouseup",l);g=parseInt(c.slider.css("top"),10);a=b.clientY});this.scrollbar_wrap.click(function(a){a.stopPropagation()});this.scroll_top.add(this.scroll_bottom).bind({mousedown:function(a){var b,d;a.target==c.scroll_top[0]?(b=-1,d=0):(b=1,d=c.params.stopScroll); e=setInterval(function(){var a=parseInt(c.slider.css("top"),10);a==d?(clearInterval(e),c.slider.css("top",d+"px")):(c.slider.css("top",a+b+"px"),c.scrollcontent.css("margin-top",-1*c.params.multiple*(a+b)+"px"))},4)},mouseup:function(){clearInterval(e)}});this.scrollbar.bind("click",function(a){if(a.target!=c.scrollbar[0])return!1;a=a.pageY;var b=c.slider.offset().top,d=parseInt(c.scrollcontent.css("margin-top"),10),f,h=0,g;a<b?(f=a-b,g=-1*Math.round(2*(c.params.scrollcontent_h/c.params.scrollpane_h))): (f=a-b-c.params.size_slider,g=1*Math.round(2*(c.params.scrollcontent_h/c.params.scrollpane_h)));e=setInterval(function(){if(h+g>=f&&0<g||h+g<=f&&0>g)return clearInterval(e),c.slider.offset({top:b+f}),c.scrollcontent.css("margin-top",d-c.params.multiple*f+"px"),!1;c.slider.offset({top:c.slider.offset().top+g});c.scrollcontent.css("margin-top",parseInt(c.scrollcontent.css("margin-top"),10)-g*c.params.multiple+"px");h+=g},1)})}var b={btnsWidth:16,btnsHeight:16,bordersWidth:1};d.prototype.move=function(b, c){var d,e=this.params;d=b<e.scrollpane_h-e.scrollcontent_h?e.scrollpane_h-e.scrollcontent_h:b;e=Math.abs(d)/e.percentContent*e.percentSlider;this.slider.css("top",e+"px");void 0==c?this.scrollcontent.animate({"margin-top":d+"px"},800):this.scrollcontent.css({"margin-top":!0===c?b:d+"px"})};d.prototype.show=function(){this.scrollbar_wrap.css("display","block")};d.prototype.hide=function(){this.scrollbar_wrap.css("display","none")};d.prototype.renew=function(){f(this.scrollpane,this.scrollcontent, this.slider)};return new d(e)}})(window.jQuery);
